<!DOCTYPE HTML>

<html>
<head>
    <title>å¦‚ä½•è³ºéŒ¢</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <link type="image/png" sizes="96x96" rel="icon" href="assets/icons8-hard-working-96.png">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body class="is-preload">

    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Main -->
        <div id="main">
            <div class="inner">

                <!-- Content -->
                <section>
                    <header class="main">
                        <h1>å¦‚ä½•è³ºéŒ¢</h1>
                    </header>

                    <span class="image main"><img src="images/pic01.jpg" alt="" /></span>
                    <p>å–¬æ²»æ˜¯ä¸€åç¨‹å¼è¨­è¨ˆå¸«ï¼Œä»–å°æ–¼é›»è…¦å’Œç¨‹å¼èªè¨€æœ‰è‘—æ¥µæ·±åšçš„ç†±æƒ…ã€‚ä»–åœ¨å¤§å­¸æ™‚æœŸé¸æ“‡äº†è³‡è¨Šå·¥ç¨‹ä½œç‚ºä»–çš„å°ˆæ¥­ï¼Œä¸¦ä¸”åœ¨ç•¢æ¥­å¾Œä¹Ÿé †åˆ©åœ°æ‰¾åˆ°äº†ä¸€ä»½ç¨‹å¼è¨­è¨ˆå¸«çš„å·¥ä½œã€‚</p>

                    <p>å–¬æ²»åœ¨å·¥ä½œä¸­è¡¨ç¾å¾—éå¸¸å„ªç§€ï¼Œä»–çš„ç¨‹å¼æŠ€å·§å’Œå‰µé€ åŠ›éƒ½è®“åŒäº‹å€‘ååˆ†ä½©æœã€‚ä»–çš„å·¥ä½œè¡¨ç¾ä¹Ÿè®“ä»–çš„è€é—†éå¸¸æ»¿æ„ï¼Œçµ¦äº†ä»–ç›¸æ‡‰çš„æ™‰å‡å’Œè–ªæ°´åŠ è–ªã€‚ä½†æ˜¯ï¼Œå–¬æ²»åœ¨ç¶“éäº†ä¸€æ®µæ™‚é–“çš„å·¥ä½œå¾Œï¼Œé–‹å§‹æ„Ÿåˆ°äº†ç„¡èŠå’Œç–²æ†Šã€‚</p>

                    <p>ä»–ç™¼ç¾è‡ªå·±åœ¨é€™å€‹è¡Œæ¥­è£¡å·²ç¶“åšäº†å¹¾å¹´äº†ï¼Œä½†æ˜¯ä»–ä¸¦æ²’æœ‰æ„Ÿåˆ°ä»»ä½•çš„æˆå°±æ„Ÿã€‚æ¯å¤©é‡è¤‡çš„ç·¨å¯«ç¨‹å¼ç¢¼ï¼Œæ²’æœ‰ä»»ä½•æ–°çš„æŒ‘æˆ°å’Œæ¨‚è¶£ï¼Œè®“ä»–é–‹å§‹åæ€è‡ªå·±çš„äººç”Ÿã€‚ä»–é–‹å§‹æƒ³è‘—ï¼Œé€™æ¨£ç¹¼çºŒä¸‹å»ï¼Œä»–çš„äººç”Ÿæœƒè®Šå¾—æ¯«ç„¡æ„ç¾©ã€‚</p>

                    <p>åœ¨é€™å€‹é—œéµæ™‚åˆ»ï¼Œå–¬æ²»æ±ºå®šæ”¾æ£„ä»–çš„ç¨‹å¼è¨­è¨ˆå¸«å·¥ä½œï¼Œè½‰è€Œåˆ°è¾²å ´è£¡å·¥ä½œã€‚é€™å€‹æ±ºå®šè®“ä»–çš„å®¶äººå’Œæœ‹å‹å€‘éƒ½æ„Ÿåˆ°ååˆ†é©šè¨ï¼Œç”šè‡³æœ‰äº›äººèªç‚ºä»–ç˜‹äº†ã€‚</p>

                    <p>ä½†æ˜¯ï¼Œå–¬æ²»ä¸¦ä¸åœ¨æ„ä»–äººçš„çœ‹æ³•ï¼Œä»–ç›¸ä¿¡é€™æ¨£çš„æ±ºå®šæ˜¯å°çš„ã€‚ä»–é–‹å§‹ç ”ç©¶è¾²æ¥­çŸ¥è­˜ï¼Œå­¸ç¿’å¦‚ä½•ç¨®æ¤ä½œç‰©å’Œé£¼é¤Šå‹•ç‰©ã€‚ä»–åŠªåŠ›åœ°å·¥ä½œï¼Œæ¯å¤©éƒ½åœ¨è¾²å ´ä¸Šå¿™ç¢Œè‘—ï¼Œä½†æ˜¯ä»–æ„Ÿåˆ°è‡ªå·±çš„ç”Ÿæ´»è®Šå¾—æ›´åŠ æœ‰æ„ç¾©å’Œå……å¯¦ã€‚</p>

                    <p>ä»–äº«å—è‘—åœ¨è¾²å ´ä¸Šå·¥ä½œçš„æ„Ÿè¦ºï¼Œæ¯å¤©éƒ½å¯ä»¥çœ‹åˆ°è‡ªå·±çš„æ±—æ°´åŒ–ç‚ºæœå¯¦ï¼Œé€™ç¨®æˆå°±æ„Ÿè®“ä»–ååˆ†æ»¿è¶³ã€‚æ­¤å¤–ï¼Œè¾²å ´ä¸Šä¹Ÿæœ‰å¾ˆå¤šæŒ‘æˆ°å’Œå›°é›£ï¼Œéœ€è¦ä»–å»è§£æ±ºã€‚ä»–å¿…é ˆé¢å°å¤©æ°£è®ŠåŒ–ã€å‹•ç‰©ç–¾ç—…å’Œå…¶ä»–å•é¡Œï¼Œé€™äº›éƒ½éœ€è¦ä»–ä»˜å‡ºæ›´å¤šçš„å¿ƒåŠ›å’ŒåŠªåŠ›ã€‚</p>

                    <p>ç•¶å–¬æ²»è½‰å‹ç‚ºè¾²å¤«ä¹‹å¾Œï¼Œä»–ç™¼ç¾è‡ªå·±å°ç”Ÿæ´»æœ‰äº†æ–°çš„çœ‹æ³•ã€‚ä»–é–‹å§‹çæƒœæ¯ä¸€å€‹ç´°ç¯€ï¼Œ</p>

                    <p>å¾ç¨®æ¤åˆ°æ”¶æˆçš„æ¯ä¸€å€‹ç’°ç¯€ï¼Œä»–éƒ½è¦ªèº«åƒèˆ‡å…¶ä¸­ï¼Œä¸¦ä¸”æ„Ÿå—åˆ°äº†ç”Ÿå‘½çš„åƒ¹å€¼å’Œæ„ç¾©ã€‚ä»–ä¹Ÿé–‹å§‹æ›´åŠ é—œæ³¨ç’°å¢ƒä¿è­·å’Œå¯æŒçºŒç™¼å±•ï¼Œä»–çŸ¥é“åªæœ‰å°å¤§è‡ªç„¶è² è²¬ï¼Œæ‰èƒ½è®“äººé¡é•·ä¹…åœ°ç¹è¡å’Œç”Ÿå­˜ä¸‹å»ã€‚</p>

                    <p>å–¬æ²»çš„æ±ºå®šé›–ç„¶è®“äººæ„Ÿåˆ°æ„å¤–ï¼Œä½†æ˜¯ä»–çš„å®¶äººå’Œæœ‹å‹å€‘ä¹Ÿæ¼¸æ¼¸åœ°ç†è§£å’Œæ”¯æŒä»–ã€‚ä»–å€‘çœ‹åˆ°äº†å–¬æ²»åœ¨è¾²å ´ä¸Šçš„è¾›å‹¤ä»˜å‡ºå’Œæˆå°±ï¼Œä¹Ÿé–‹å§‹å°Šé‡ä»–çš„æ±ºå®šã€‚æ­¤å¤–ï¼Œå–¬æ²»ä¹Ÿèˆ‡è¨±å¤šæœ‰å…±åŒç†å¿µçš„è¾²å¤«å»ºç«‹èµ·äº†è‰¯å¥½çš„é—œä¿‚ï¼Œå½¼æ­¤äº’ç›¸å­¸ç¿’å’Œäº¤æµï¼Œè®“ä»–æ›´åŠ å……å¯¦å’Œå¿«æ¨‚ã€‚</p>

                    <p>é›–ç„¶å–¬æ²»çš„ç”Ÿæ´»ç™¼ç”Ÿäº†å·¨å¤§çš„è®ŠåŒ–ï¼Œä½†æ˜¯ä»–å¾ä¸­ç²å¾—äº†æ›´å¤šçš„æ”¶ç©«å’Œæ»¿è¶³æ„Ÿã€‚ä»–çŸ¥é“è‡ªå·±åœ¨è¾²å ´ä¸Šçš„å·¥ä½œæˆ–è¨±ä¸å¦‚ç¨‹å¼è¨­è¨ˆå¸«é‚£éº¼é«˜è–ªå’Œç‚«ç›®ï¼Œä½†æ˜¯ä»–å»æ„Ÿåˆ°è‡ªå·±æ›´åŠ å¿«æ¨‚å’Œè‡ªç”±ã€‚ä»–å¾ä¸­å­¸æœƒäº†çæƒœç”Ÿå‘½ï¼Œçæƒœæ™‚é–“ï¼Œä¸¦ä¸”æ˜ç™½äº†ç”Ÿå‘½çš„çœŸè«¦åœ¨æ–¼äº«å—ç•¶ä¸‹ï¼Œæ´»åœ¨ç•¶ä¸‹ã€‚</p>

                    <p>ç¶œåˆä¾†çœ‹ï¼Œå–¬æ²»çš„æ±ºå®šæˆ–è¨±æœ‰äº›å‡ºä¹æ„æ–™ï¼Œä½†æ˜¯å»è®“ä»–ç²å¾—äº†æ›´å¤šçš„ç”Ÿå‘½åƒ¹å€¼å’Œæ„ç¾©ã€‚ç„¡è«–æ˜¯ç¨‹å¼è¨­è¨ˆå¸«é‚„æ˜¯è¾²å¤«ï¼Œæ¯ä¸€å€‹äººéƒ½æœ‰è‡ªå·±çš„é¸æ“‡å’Œè¿½æ±‚ã€‚é‡è¦çš„æ˜¯ï¼Œæˆ‘å€‘è¦æ‰¾åˆ°å±¬æ–¼è‡ªå·±çš„è·¯ï¼Œå‹‡æ•¢åœ°èµ°ä¸‹å»ï¼Œä¸¦ä¸”åœ¨é€™å€‹éç¨‹ä¸­å­¸æœƒçæƒœå’Œäº«å—ç”Ÿå‘½çš„æ—…ç¨‹ã€‚</p>

                    <header class="main">
                        <h3>ğŸ‘‹ ç•™è¨€æ¿</h3>
                    </header>

                    <!-- ä½¿ç”¨è€…è³‡è¨Š -->
                    <section id="user-info" style="display: none;">
                        <p>æ­¡è¿ï¼Œ<span id="currentUsername"></span>ï¼<button id="logoutButton">ç™»å‡º</button></p>
                    </section>

                    <!-- ç•™è¨€æ¿ -->
                    <section id="comments-section">
                        <div id="comments"></div>
                        <form id="commentForm">
                            <textarea name="message" id="message" placeholder="è«‹åœ¨é€™è£¡è¼¸å…¥å…§å®¹..." rows="4" required></textarea>
                            <br>
                            <button type="submit">æäº¤ç•™è¨€</button>
                        </form>
                    </section>

                    <!-- ç™»å…¥è¡¨å–® -->
                    <section id="login-section">
                        <header class="main">
                            <h2>ç™»å…¥</h2>
                        </header>
                        <form id="loginForm">
                            <label for="loginUsername">ç”¨æˆ¶å</label>
                            <input type="text" id="loginUsername" name="username" required>
                            <label for="loginPassword">å¯†ç¢¼</label>
                            <input type="password" id="loginPassword" name="password" required>
                            <button type="submit">ç™»å…¥</button>
                        </form>
                        <p>é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿ<a href="#" id="showRegister">è¨»å†Š</a></p>
                    </section>

                    <!-- è¨»å†Šè¡¨å–® -->
                    <section id="register-section" style="display: none;">
                        <header class="main">
                            <h2>è¨»å†Š</h2>
                        </header>
                        <form id="registerForm">
                            <label for="registerUsername">ç”¨æˆ¶å</label>
                            <input type="text" id="registerUsername" name="username" required>
                            <label for="registerEmail">é›»å­éƒµä»¶</label>
                            <input type="email" id="registerEmail" name="email" required>
                            <label for="registerPassword">å¯†ç¢¼</label>
                            <input type="password" id="registerPassword" name="password" required>
                            <button type="submit">è¨»å†Š</button>
                        </form>
                        <p>å·²ç¶“æœ‰å¸³è™Ÿäº†ï¼Ÿ<a href="#" id="showLogin">ç™»å…¥</a></p>
                    </section>
                </section>
            </div>
        </div>

        <!-- æµ®å‹•æŒ‰éˆ• -->
        <div id="floating-button" onclick="scrollToTop()">
            <img src="assets/arrow-up.png" alt="Arrow" width="50" height="50">
        </div>
        <script>
            function scrollToTop() {
                $('html, body').animate({
                    scrollTop: 0
                }, 'slow');
            }
        </script>

        <!-- Sidebar -->
        <div id="sidebar">
            <div class="inner">

                <!-- Search -->
                <section>
                    <form action="https://cse.google.com/cse?cx=a6281ea9750794650" id="a6281ea9750794650">
                        <input type="hidden" name="cx" value="a6281ea9750794650">
                        <input type="hidden" name="ie" value="UTF-8">

                        <input type="text" name="q" placeholder="ç«™å…§æœå°‹">
                        <button type="submit">æœå°‹</button>
                    </form>
                </section>

                <!-- Menu -->
                <nav id="menu">
                    <header class="major">
                        <h2>Menu</h2>
                    </header>
                    <ul>
                        <li><a href="index.htm">ğŸ  é¦–é </a></li>
                        <li><a href="photo_post/about.html">ğŸ“‚ é—œæ–¼æˆ‘</a></li>
                        <li><a href="photo_post/photo_index.html">ğŸ“¸ ç›¸ç°¿</a></li>
                        <li><a href="feedback.html">ğŸ’¬ æ„è¦‹å›é¥‹</a></li>
                    </ul>
                </nav>

                <section>
                    <header class="major">
                        <h2>ğŸ“Œ é‡˜é¸æ–‡ç« </h2>
                    </header>
                    <div class="mini-posts">

                        <article>
                            <a href="1.html" class="image"><img src="images/pic01.jpg" alt="" /><br><br>
                                <h3>å¦‚ä½•è³ºéŒ¢</h3></a>
                        </article>
                        <article>
                            <a href="photo_post/about.html" class="image"><img src="photo_post/assets/img/about/hi.PNG" alt="" /><br><br>
                                <h3>è‡ªæˆ‘ä»‹ç´¹</h3></a>
                        </article>
                    </div>

                </section>
                <!-- Section -->
                <section>
                    <header class="major">
                        <h2>â˜ï¸â€‚è¯çµ¡æˆ‘</h2>
                    </header>
                    <p>This is fake</p>
                    <ul class="contact">
                        <li class="icon solid fa-envelope"><a href="mailto:information@untitled.tld">information@untitled.tld</a></li>
                        <li class="icon solid fa-phone">(000) 000-0000</li>
                        <li class="icon solid fa-map">Somewhere Road<br /></li>
                    </ul>
                </section>

            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/validateForm.js"></script>
    <script src="assets/js/main.js"></script>
   

    <!-- Inline JavaScript for Authentication and Comments -->
    <script>
        $(document).ready(function () {
            // é¡¯ç¤ºè¨»å†Šè¡¨å–®
            $('#showRegister').click(function (e) {
                e.preventDefault();
                $('#login-section').hide();
                $('#register-section').show();
            });

            // é¡¯ç¤ºç™»å…¥è¡¨å–®
            $('#showLogin').click(function (e) {
                e.preventDefault();
                $('#register-section').hide();
                $('#login-section').show();
            });

            // ç™»å…¥è¡¨å–®æäº¤
            $('#loginForm').submit(function (e) {
                e.preventDefault();
                const username = $('#loginUsername').val();
                const password = $('#loginPassword').val();

                $.ajax({
                    url: 'https://duvtzrkm03.execute-api.us-east-1.amazonaws.com/login',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ username, password }),
                    success: function (response) {
                        // å„²å­˜ token
                        localStorage.setItem('token', response.token);
                        alert('ç™»å…¥æˆåŠŸ');

                        // éš±è—ç™»å…¥è¡¨å–®ï¼Œé¡¯ç¤ºç•™è¨€æ¿å’Œä½¿ç”¨è€…è³‡è¨Š
                        $('#login-section').hide();
                        $('#register-section').hide();
                        $('#user-info').show();

                        // è§£ç¢¼ JWT ä»¥ç²å–ç”¨æˆ¶å
                        const payload = JSON.parse(atob(response.token.split('.')[1]));
                        $('#currentUsername').text(payload.username);

                        $('#comments-section').show();
                        getComments();
                    },
                    error: function (xhr) {
                        alert(xhr.responseJSON.message || 'ç™»å…¥å¤±æ•—');
                    }
                });
            });

            // è¨»å†Šè¡¨å–®æäº¤
            $('#registerForm').submit(function (e) {
                e.preventDefault();
                const username = $('#registerUsername').val();
                const email = $('#registerEmail').val();
                const password = $('#registerPassword').val();

                $.ajax({
                    url: 'https://duvtzrkm03.execute-api.us-east-1.amazonaws.com/register',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ username, email, password }),
                    success: function (response) {
                        alert('è¨»å†ŠæˆåŠŸï¼Œè«‹ç™»å…¥');
                        $('#register-section').hide();
                        $('#login-section').show();
                    },
                    error: function (xhr) {
                        alert(xhr.responseJSON.message || 'è¨»å†Šå¤±æ•—');
                    }
                });
            });

            // ç™»å‡ºåŠŸèƒ½
            $('#logoutButton').click(function () {
                localStorage.removeItem('token');
                alert('å·²ç™»å‡º');
                $('#user-info').hide();
                $('#comments-section').hide();
                $('#login-section').show();
            });

            // æäº¤ç•™è¨€è¡¨å–®
            $('#commentForm').submit(function (e) {
                e.preventDefault();
                const content = $('#message').val();
                const token = localStorage.getItem('token');

                if (!token) {
                    alert('è«‹å…ˆç™»å…¥');
                    return;
                }

                $.ajax({
                    url: 'https://duvtzrkm03.execute-api.us-east-1.amazonaws.com/comments',
                    method: 'POST',
                    contentType: 'application/json',
                    headers: { 'Authorization': token },
                    data: JSON.stringify({ content }),
                    success: function (response) {
                        alert('ç•™è¨€æäº¤æˆåŠŸ');
                        $('#message').val('');
                        getComments();
                    },
                    error: function (xhr) {
                        alert(xhr.responseJSON.message || 'ç•™è¨€æäº¤å¤±æ•—');
                    }
                });
            });

            // ç²å–ä¸¦é¡¯ç¤ºç•™è¨€
            function getComments() {
                $.ajax({
                    url: 'https://duvtzrkm03.execute-api.us-east-1.amazonaws.com/comments',
                    method: 'GET',
                    success: function (response) {
                        const comments = response.comments;
                        $('#comments').empty();
                        comments.forEach(comment => {
                            const commentElement = `
                                <div class="comment" data-id="${comment.comment_id}" data-user="${comment.user_id}">
                                    <div class="avatar">
                                        <img src="assets/images/user.png" alt="User Avatar">
                                    </div>
                                    <div class="comment-content">
                                        <h3 class="username">${comment.user_id}</h3>
                                        <p class="message">${comment.content}</p>
                                        ${comment.user_id === getCurrentUserId() ? `
                                            <button class="edit-comment">ç·¨è¼¯</button>
                                            <button class="delete-comment">åˆªé™¤</button>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                            $('#comments').append(commentElement);
                        });
                    },
                    error: function (xhr) {
                        alert(xhr.responseJSON.message || 'ç„¡æ³•ç²å–ç•™è¨€');
                    }
                });
            }

            // ç·¨è¼¯ç•™è¨€
            $('#comments').on('click', '.edit-comment', function () {
                const commentDiv = $(this).closest('.comment');
                const commentId = commentDiv.data('id');
                const currentContent = commentDiv.find('.message').text();
                const newContent = prompt('è«‹è¼¸å…¥æ–°çš„ç•™è¨€å…§å®¹ï¼š', currentContent);

                if (newContent === null) return; // ä½¿ç”¨è€…å–æ¶ˆ

                const token = localStorage.getItem('token');

                $.ajax({
                    url: `https://duvtzrkm03.execute-api.us-east-1.amazonaws.com/comments/${commentId}`,
                    method: 'PUT',
                    contentType: 'application/json',
                    headers: { 'Authorization': token },
                    data: JSON.stringify({ content: newContent }),
                    success: function (response) {
                        alert('ç•™è¨€å·²æ›´æ–°');
                        getComments();
                    },
                    error: function (xhr) {
                        alert(xhr.responseJSON.message || 'ç•™è¨€æ›´æ–°å¤±æ•—');
                    }
                });
            });

            // åˆªé™¤ç•™è¨€
            $('#comments').on('click', '.delete-comment', function () {
                const commentDiv = $(this).closest('.comment');
                const commentId = commentDiv.data('id');

                if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™æ¢ç•™è¨€å—ï¼Ÿ')) return;

                const token = localStorage.getItem('token');

                $.ajax({
                    url: `https://duvtzrkm03.execute-api.us-east-1.amazonaws.com/comments/${commentId}`,
                    method: 'DELETE',
                    headers: { 'Authorization': token },
                    success: function (response) {
                        alert('ç•™è¨€å·²åˆªé™¤');
                        getComments();
                    },
                    error: function (xhr) {
                        alert(xhr.responseJSON.message || 'ç•™è¨€åˆªé™¤å¤±æ•—');
                    }
                });
            });

            // ç²å–ç•¶å‰ä½¿ç”¨è€… IDï¼ˆå¾ token è§£ç¢¼ï¼‰
            function getCurrentUserId() {
                const token = localStorage.getItem('token');
                if (!token) return null;
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    return payload.user_id;
                } catch (e) {
                    return null;
                }
            }

            // ç•¶é é¢è¼‰å…¥æ™‚æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
            if (localStorage.getItem('token')) {
                try {
                    const token = localStorage.getItem('token');
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    const username = payload.username;
                    $('#currentUsername').text(username);
                    $('#user-info').show();
                    $('#comments-section').show();
                    $('#login-section').hide();
                    $('#register-section').hide();
                    getComments();
                } catch (e) {
                    // å¦‚æœ token ç„¡æ•ˆï¼Œæ¸…é™¤ä¸¦é¡¯ç¤ºç™»å…¥è¡¨å–®
                    localStorage.removeItem('token');
                    $('#user-info').hide();
                    $('#comments-section').hide();
                    $('#login-section').show();
                }
            } else {
                $('#user-info').hide();
                $('#comments-section').hide();
                $('#login-section').show();
            }
        });
    </script>

</body>

</html>